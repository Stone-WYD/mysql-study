{"ID":"ZL5EM","style":100,"lineKeepThin":true,"objectClass":"NSDictionary","root":{"ID":"724ML","objectClass":"MindNode","children":{"7":{"ID":"5Y5QW","shrink":true,"objectClass":"MindNode","children":{"1":{"ID":"675M5","objectClass":"MindNode","children":{"0":{"ID":"5BZ4Q","maxWidthLine":360,"objectClass":"MindNode","children":{"0":{"objectClass":"MindNode","ID":"8U56V","text":""},"objectClass":"NSArray"},"text":"从flush链的最后一个节点中获取oldest_modification作为checkpoint_lsn的值"},"1":{"objectClass":"MindNode","ID":"4ZE70","text":"找到checkpoint_lsn对应的日志在文件中的偏移位置，然后把checkpoint的相关变量添加到对应的日志文件的管理信息中"},"objectClass":"NSArray"},"text":"执行步骤"},"2":{"ID":"5F39N","objectClass":"MindNode","children":{"0":{"objectClass":"MindNode","ID":"CF2X4","text":"日志何时无效：脏页被刷新到磁盘上，日志lsn小于 flush链上最后一个节点的oldest_modification的之前的值的日志都是可以被覆盖的。"},"1":{"objectClass":"MindNode","ID":"57MBO","text":"刷脏后才可以进行checkpoint操作"},"objectClass":"NSArray"},"text":"注意"},"0":{"objectClass":"MindNode","ID":"WYIF7","text":"对checkpoint_lsn进行一个增加操作"},"objectClass":"NSArray"},"text":"checkpoint"},"3":{"ID":"H11E0","shrink":true,"objectClass":"MindNode","children":{"0":{"objectClass":"MindNode","ID":"8N1B6","text":"redo日志的最小分组，即某一组redo日志，要么全部记录，要么全部不记录"},"1":{"ID":"E5YC1","maxWidthLine":392.515625,"objectClass":"MindNode","text":"实现：在一组redo最后加上一个MLOG_MULTl_REC_END,解析到该类型才会认为是一组完整的redo日志"},"objectClass":"NSArray"},"text":"Mini-Transaction"},"4":{"ID":"UC39T","style2":{"objectClass":"NSDictionary","color":"#000000"},"objectClass":"MindNode","children":{"objectClass":"NSArray","0":{"ID":"TTK1W","objectClass":"MindNode","children":{"1":{"objectClass":"MindNode","text":"log block body","ID":"P53WW"},"objectClass":"NSArray","0":{"ID":"08717","objectClass":"MindNode","children":{"objectClass":"NSArray","0":{"objectClass":"MindNode","text":"LOG_BLOCK_CHECKPOINT_NO","ID":"92D5T"}},"text":"log block header"},"2":{"objectClass":"MindNode","text":"log block trailer","ID":"21X52"}},"text":"一页一页存放日志，\n一页为一个lock"},"1":{"objectClass":"MindNode","text":"以MTR为最小单位存放，但不同语句的MTR可以交替写入","ID":"8U4TB"}},"text":"log buffer : 日志缓冲区"},"0":{"ID":"80Y57","objectClass":"MindNode","children":{"objectClass":"NSArray","0":{"ID":"4B73M","objectClass":"MindNode","children":{"objectClass":"NSArray","0":{"objectClass":"MindNode","text":"为一点修改刷新一个页面不太值","ID":"8MNC3"},"1":{"objectClass":"MindNode","text":"改的内容可能涉及很多页，随机I\/O很多","ID":"7JS37"}},"text":"为了保证持久性，当修改了页面就将Buffer Pool中的页面刷回磁盘是低效的"},"1":{"ID":"LNXS6","maxWidthLine":323,"objectClass":"MindNode","children":{"objectClass":"NSArray","0":{"objectClass":"MindNode","text":"redo日志占用空间小","ID":"F79RE"},"1":{"objectClass":"MindNode","text":"redo日志写入磁盘时是顺序写入","ID":"9N267"}},"text":"“将修改了哪个表哪个页哪个字段”以日志形式记录下来存到磁盘，断电重启后按照日志redo"}},"text":"redo日志是什么"},"5":{"ID":"2OU42","shrink":true,"objectClass":"MindNode","children":{"1":{"objectClass":"MindNode","ID":"39V5E","text":"日志文件组：循环写"},"2":{"ID":"Q7U64","objectClass":"MindNode","children":{"0":{"ID":"COXT0","objectClass":"MindNode","children":{"3":{"objectClass":"MindNode","ID":"4JR0B","text":"checkpoint2"},"1":{"objectClass":"MindNode","ID":"405FJ","text":"checkpoint1"},"2":{"objectClass":"MindNode","ID":"54D1Q","text":"没用"},"0":{"ID":"H4JP5","objectClass":"MindNode","children":{"0":{"objectClass":"MindNode","ID":"2BR05","text":"LOG_HEADER_START_LSN"},"1":{"objectClass":"MindNode","ID":"XQ8GO","text":"......"},"objectClass":"NSArray"},"text":"log file header"},"objectClass":"NSArray"},"text":"管理头（4个block大小：2048个字节）"},"1":{"objectClass":"MindNode","ID":"BYHLW","text":"后面存放了多个log block （日志页）"},"objectClass":"NSArray"},"text":"日志文件格式"},"0":{"ID":"2U2N1","shrink":true,"objectClass":"MindNode","children":{"3":{"objectClass":"MindNode","ID":"R40IA","text":"正常关闭服务器"},"1":{"objectClass":"MindNode","ID":"3L33D","text":"事务提交"},"4":{"objectClass":"MindNode","ID":"C3F3V","text":"做 checkpoint 时"},"2":{"objectClass":"MindNode","ID":"76R1R","text":"后台线程每秒刷新一次"},"0":{"objectClass":"MindNode","ID":"NBQB2","text":"log buffer 空间不足时"},"objectClass":"NSArray"},"text":"刷盘时机"},"objectClass":"NSArray"},"text":"日志文件"},"1":{"ID":"2532V","objectClass":"MindNode","children":{"objectClass":"NSArray","0":{"objectClass":"MindNode","text":"type | space ID | page number |    data    |","ID":"F7C1Q"}},"text":"redo日志通用结构"},"objectClass":"NSArray","6":{"remark":"一个全局变量：表示当前写入的日志量","remarkDisplay":true,"shrink":true,"children":{"3":{"ID":"4Y7RS","remark":"全局变量：表示当前已经被写入到磁盘的日志量","remarkDisplay":true,"objectClass":"MindNode","children":{"0":{"objectClass":"MindNode","ID":"1YVF0","text":"初始值与lsn相等"},"1":{"objectClass":"MindNode","ID":"HDNX1","text":"但是只有日志被记录到磁盘上时，才会增加"},"objectClass":"NSArray"},"text":"flushed_to_disk_lsn"},"1":{"ID":"Z3T6F","objectClass":"MindNode","children":{"0":{"ID":"3STG8","maxWidthLine":323.703125,"objectClass":"MindNode","text":"一方面会存放在log buffer的block的header中"},"1":{"ID":"66517","objectClass":"MindNode","children":{"0":{"objectClass":"MindNode","ID":"XU2O4","text":"通过flush链上的lsn，可以在log buffer中找到对应的redo日志信息"},"1":{"objectClass":"MindNode","ID":"5R6IP","text":"也可以在redo log file中找到对应的日志信息 "},"objectClass":"NSArray"},"text":"另一方面也会存放在flush链的节点上"},"objectClass":"NSArray"},"text":"lsn增大过程中"},"2":{"objectClass":"MindNode","ID":"NA1PY","text":"日志有唯一的lsn值，所以日志的lsn值越小，说明日志产生地越早"},"0":{"objectClass":"MindNode","ID":"5PBAC","text":"刚开始在log buffer中，随着日志的记录，lsn的值也在不断增大"},"objectClass":"NSArray"},"text":"log sequence number ( lsn )","objectClass":"MindNode","ID":"W7KC4"},"2":{"ID":"8Y01T","shrink":true,"objectClass":"MindNode","children":{"0":{"ID":"3LZF7","remark":"更改系统页面较多","remarkDisplay":true,"objectClass":"MindNode","children":{"0":{"ID":"108L7","objectClass":"MindNode","children":{"0":{"objectClass":"MindNode","ID":"O3XL9","text":"修改X个字节的内容"},"1":{"ID":"5CD4P","maxWidthLine":351,"objectClass":"MindNode","text":"type | space ID | page number | offset |    data    |"},"objectClass":"NSArray"},"text":"MLOG_ XBYTE（X可为1，2，4，8）"},"1":{"ID":"Q7883","objectClass":"MindNode","children":{"0":{"objectClass":"MindNode","ID":"8682M","text":"修改了一个字节序列"},"1":{"ID":"FB0IY","maxWidthLine":390,"objectClass":"MindNode","text":"type | space ID | page number | offset | len |    data    |"},"objectClass":"NSArray"},"text":"MLOG_WRITE_STRlNG"},"objectClass":"NSArray"},"text":"修改内容较少，几个字节"},"1":{"ID":"WCVOY","objectClass":"MindNode","children":{"0":{"ID":"2L7G1","objectClass":"MindNode","children":{"1":{"ID":"1YT5Q","objectClass":"MindNode","children":{"0":{"objectClass":"MindNode","ID":"39QVL","text":"通过一些准备好的函数，从redo日志中获取必要的参数将记录插入到表中以实现redo"},"objectClass":"NSArray"},"text":"逻辑层面"},"2":{"objectClass":"MindNode","ID":"IRBNP","text":"会想各种方法优化压缩redo日志大小"},"0":{"ID":"CD6M0","objectClass":"MindNode","children":{"0":{"objectClass":"MindNode","ID":"37584","text":"日志指明了对哪个表空间的哪个页进行修改"},"objectClass":"NSArray"},"text":"物理层面"},"objectClass":"NSArray"},"text":"MLOG_COMP_REC_INSERT"},"1":{"objectClass":"MindNode","ID":"6L7S0","text":"......"},"objectClass":"NSArray"},"text":"修改较多内容"},"objectClass":"NSArray"},"text":"redo日志的类型"}},"text":"redo日志"}}